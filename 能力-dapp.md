# dapp能力

用户提出需求, 基于链上交易实现的app的想法

我会做以下事情:

反复整理确认需求, 方向、目标、初始值、转折点、核心业务、核心计算区、商业模式融合, 编写用户操作文档, 同时推测用户可能出现的其他操作

链选型, 钱包测试, 关键功能测试

编写测试用例, 假设测试缩放系数, 例如: 时间、金额、层级关系, 单用户操作流程, 多用户测试流量, 编写自动化测试脚本全自动模拟全用户全流程动作

编写计算公式计算可能的结果数字, 从而推断时间





# 金融交易系统设计与实现

作用
poc场景为基于区块链的app
服务器
选取3个供应商将服务器分布在三个机房区, 例如美国/日本/新加坡/香港
使用debian操作系统, lvm加密底层磁盘
ssh只开放证书登录
使用防火墙
使用堡垒机管理服务器(业务账户/审计记录) , 堡垒机用户必须绑定MFA
指标监控服务, 包含主机，服务, 通过telegram bot进行通知告警, alert自动收敛高频通知
数据库
存储额外加工数据
使用分布式数据库，而不是单机数据库，因为服务器可能会宕机甚至丢失数据, 业务系统的一次写入得同时落盘到多台服务器上
涉及到金额的字段使用超长整数类型, 例如区块链的金额为18位, 以postgresql为例子, 使用numeric(30, 0), 程序中使用bigDecimal进行计算(加减乘除)
网络隔离, 不绑定主机网络, 精细控制来访ip, 业务使用专门的账号和最小化的权限
在与外部系统交互的地方
 
使用就近数据库进行落库, 尽量不要修改数据, 保留数据的连贯性

代码管理
使用远程版本服务管理代理, 例如git服务器
不要提交本地运行的配置文件, 不要提交生产环境的部署配置文件
程序
确保无限定时循环的线程没有异常导致线程中断退出, 如果无法确保则需要在主线程中定时检查恢复子线程
记录每一次钱发生变化的地方到数据库和日志文件中

合约
安全性设计
不使用代理合约, 或者代理合约需要regualtor同意
账号分离, owner, regulation, service, operator
owner和regualtor对系统操作投票执行
service作为程序执行
operator作为合约运营账号
测试
在测试阶段使用缩放系统对关键分支控制变量数字进行缩小, 例如使用金额缩放系数100对100金额缩小成1, 使用时间缩放系数1440对24h缩小成1m
编写测试用例
测试分布式数据库1主n从的数据库切换能力
测试程序自动恢复能力, 测试程序的监控检查能力
使用json文件数据, 实现代码的单元测试
直接连接数据
循环创建用户, 创建足量的用户覆盖层级
循环创建交易, 创建足量的交易去测试在多次计算过程中可能会引起的问题
	

数据分析和告警	
创建精细化的只读账号
重新部署一个数据库, 作为从库同步主库数据
过程数据记录到表中, 过程表含有创建人/动作/数量

服务上线
购买加密卡, 作为冷钱包存储
创建用户账号, 给该用户账号转入gas费, 并转出0测试可用性
owner创建完合约之后, 转移owner为冷钱包的用户账号
创建新的服务商，服务器lvm/ssh密钥文件，堡垒机mfa



​	
